import{r as i,c as s,h as t,H as a,g as e}from"./p-a880f6ce.js";import{c as l,g as h}from"./p-3e8ff66b.js";import{m as o}from"./p-8f313b4b.js";import{F as r}from"./p-3edac1bb.js";import{i as n,e as d,a as b,s as c,c as u,d as p}from"./p-27ef59b5.js";import"./p-a66809ee.js";var f=l((function(i,s){Object.defineProperty(s,"__esModule",{value:!0}),s.SPECS={si:{radix:1e3,unit:["b","kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"]},iec:{radix:1024,unit:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"]},jedec:{radix:1024,unit:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"]}}}));const m=h(l((function(i,s){Object.defineProperty(s,"__esModule",{value:!0}),s.default=function(i,s,t){void 0===s&&(s=1),i=Math.abs(i);for(var a=f.SPECS[t]||f.SPECS.jedec,e=a.radix,l=a.unit,h=0;i>=e;)i/=e,++h;return i.toFixed(s)+" "+l[h]}}))),g=class{constructor(t){i(this,t),this.balChange=s(this,"balChange",7),this.balFilesAddedEmitter=s(this,"balFilesAdded",7),this.balFilesRemovedEmitter=s(this,"balFilesRemoved",7),this.balClick=s(this,"balClick",7),this.balBlur=s(this,"balBlur",7),this.balFocus=s(this,"balFocus",7),this.balRejectedFileEventEmitter=s(this,"balRejectedFile",7),this.uploadId="bal-upload-"+v++,this.bundleSize=0,this.handleFiles=i=>{if(!this.disabled){const s=[...this.files],t=[];for(let a=0;a<i.length;a++){const e=i.item(a);if(e){const i=[];this.accept&&-1===this.accept.split(" ").join("").split(",").indexOf(e.type)&&i.push(r.BAD_EXTENSION),this.maxFileSize&&e.size>this.maxFileSize&&i.push(r.FILE_TOO_BIG);const a=this.files.map((i=>i.size)).reduce(((i,s)=>i+s),0),l=e.size+a;this.maxBundleSize&&l>this.maxBundleSize&&i.push(r.FILE_SIZE_SUM_TOO_BIG),this.maxFiles&&s.length+1>this.maxFiles&&i.push(r.TOO_MANY_FILES),s.filter((i=>i.size===e.size&&i.name===e.name&&i.type===e.type)).length>0&&i.push(r.DUPLICATED_FILE),i.length>0?this.balRejectedFileEventEmitter.emit({file:e,reasons:i}):(s.push(e),t.push(e))}}this.files.length!==s.length&&(this.files=[...s],this.balChange.emit(this.files)),t.length>0&&this.balFilesAddedEmitter.emit(t),this.setFileList(),this.nativeInput.value=""}},this.onInputChange=()=>{var i;(null===(i=this.nativeInput)||void 0===i?void 0:i.files)&&this.handleFiles(this.nativeInput.files)},this.setFileList=()=>{const i=new DataTransfer;this.files.forEach((s=>i.items.add(s))),this.nativeInput.files=i.files},this.onInputFocus=i=>n(this,i),this.onInputBlur=i=>d(this,i),this.handleClick=i=>b(this,i),this.onInputClick=i=>{this.balClick.emit(i)},this.isOver=!1,this.files=[],this.hasFocus=!1,this.name=this.uploadId,this.label="Choose or drop a file...",this.multiple=!0,this.hasFileList=!0,this.disabled=!1,this.required=!1,this.invalid=!1,this.readonly=!1,this.accept="",this.maxFiles=void 0,this.maxFileSize=void 0,this.maxBundleSize=void 0,this.value=[],this.loading=!1,this.subTitle=void 0}onValueChange(){o(this.files,this.value)||(this.files=this.value)}dragenterHandler(){this.disabled||this.readonly||(this.isOver=!0)}dragoverHandler(){this.disabled||this.readonly||(this.isOver=!0)}dragleaveHandler(){this.disabled||this.readonly||(this.isOver=!1)}dropHandler(i){if(!this.disabled&&!this.readonly){this.isOver=!1;const s=i.dataTransfer;s&&this.handleFiles(s.files)}}componentWillLoad(){this.onValueChange()}componentDidLoad(){["dragenter","dragover","dragleave","drop"].forEach((i=>{this.el.addEventListener(i,c,{passive:!1}),document.body.addEventListener(i,c,{passive:!1})}))}disconnectedCallback(){["dragenter","dragover","dragleave","drop"].forEach((i=>{this.el.removeEventListener(i,c,!1),document.body.removeEventListener(i,c,!1)}))}async clear(){this.files=[]}async setFocus(){u(this)}async setBlur(){p(this)}getInputElement(){return Promise.resolve(this.nativeInput)}removeFile(i){if(!this.disabled&&!this.readonly){const s=[],t=[];for(let a=0;a<this.files.length;a++)a!==i?s.push(this.files[a]):t.push(this.files[a]);this.files=[...s],this.balChange.emit(this.files),this.balFilesRemovedEmitter.emit(t),this.setFileList()}}render(){return t(a,{onClick:this.handleClick,class:{"bal-file-upload":!0}},t("div",{class:{file:!0,"is-disabled":this.disabled||this.readonly||this.loading,"is-danger":this.invalid}},t("label",{class:["file-label",this.disabled||this.loading||this.readonly?"is-disabled":""].join(" ")},t("input",{class:"file-input",type:"file",name:this.name,multiple:this.multiple,disabled:this.disabled||this.loading,readonly:this.readonly,required:this.required,accept:this.accept,onClick:this.onInputClick,onChange:this.onInputChange,onFocus:this.onInputFocus,onBlur:this.onInputBlur,ref:i=>this.nativeInput=i}),this.loading?t("span",{class:"file-cta"},t("bal-spinner",null)):t("span",{class:"file-cta"},t("span",{class:"file-icon"},t("bal-icon",{name:"upload",size:"medium",color:this.disabled||this.loading||this.readonly?"grey-light":this.invalid?"danger":"blue"})),t("span",{class:"file-label"},this.label)))),this.hasFileList?t((()=>t("bal-card",{flat:!0,class:"bal-file-upload__card",style:{display:this.files.length?"block":"none"}},t("bal-list",{class:"bal-file-upload__list",disabled:this.disabled||this.loading||this.readonly,border:!0,size:"large"},this.files.map(((i,s)=>t("bal-list-item",{disabled:this.disabled||this.loading||this.readonly},t("bal-list-item-icon",null,t("bal-icon",{name:"document"})),t("bal-list-item-content",null,t("bal-list-item-title",null,i.name),t("bal-list-item-subtitle",null,this.subTitle?this.subTitle(i):m(i.size))),t("bal-list-item-icon",{right:!0,class:{"file-remove":!0,"is-clickable":!this.disabled&&!this.readonly},onClick:()=>this.removeFile(s)},t("bal-icon",{name:"trash",color:this.disabled||this.loading||this.readonly?"grey":"danger"})))))))),null):"")}get el(){return e(this)}static get watchers(){return{value:["onValueChange"]}}};let v=0;g.style={css:".bal-file-upload{display:block;position:static;width:100%}.bal-file-upload .file-label{word-break:break-word;white-space:normal}.bal-file-upload__card{margin-top:var(--bal-space-normal)}.bal-file-upload__list{padding:0 !important}"};export{g as bal_file_upload}