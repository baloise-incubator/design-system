import{r as t,c as i,h as s,H as e,g as o}from"./p-a880f6ce.js";import{l}from"./p-a66809ee.js";import{d as a,i as h,h as n,j as r}from"./p-77b56332.js";import{c,m as b,u as d,v as p,d as u,w as m,x as _}from"./p-8f313b4b.js";import{r as f,p as g,l as v,g as y,i as x,s as w,a as k,f as j,b as O,v as C}from"./p-406f68d5.js";import{s as T}from"./p-27ef59b5.js";import{B as L}from"./p-61996a75.js";import{L as z}from"./p-f382ef7c.js";import"./p-2e55b95c.js";import"./p-3e8ff66b.js";var A=Array.isArray;const B=class{constructor(s){t(this,s),this.balChange=i(this,"balChange",7),this.balClick=i(this,"balClick",7),this.balInput=i(this,"balInput",7),this.balBlur=i(this,"balBlur",7),this.balFocus=i(this,"balFocus",7),this.balCancel=i(this,"balCancel",7),this.balKeyPress=i(this,"balKeyPress",7),this.didInit=!1,this.inputId="bal-select-"+R++,this.initialValue=[],this.removeValue=t=>{this.disabled||(this.updateRawValue(f(this.rawValue,t),!0),this.multiple&&this.typeahead&&this.setFocus())},this.handleClick=t=>{(this.disabled||this.readonly)&&g(t)},this.handlePopoverChange=t=>{this.isPopoverOpen=t.detail,this.isPopoverOpen?this.updateFocus():(this.focusIndex=-1,this.multiple&&this.typeahead&&this.updateInputValue(""),this.balBlur.emit()),t.stopPropagation()},this.handleInputBlur=t=>{g(t),this.validateAfterBlur(!0),this.hasFocus=!1},this.handleInputFocus=t=>{this.balFocus.emit(t),this.hasFocus=!0},this.handleInputClick=async t=>{var i,s,e;T(t),this.isChipClicked(t)||(this.disabled||this.readonly?g(t):(this.focusIndex=-1,this.balClick.emit(t),this.typeahead?await(null===(i=this.popoverElement)||void 0===i?void 0:i.present()):this.isPopoverOpen?await(null===(s=this.popoverElement)||void 0===s?void 0:s.dismiss()):await(null===(e=this.popoverElement)||void 0===e?void 0:e.present())))},this.handleKeyPress=async t=>{!this.isPopoverOpen&&c(t)&&(g(t),await this.open()),this.balKeyPress.emit(t)},this.handleInputChange=t=>{this.disabled||this.readonly||(this.inputValue=t.target.value)},this.handleInput=async t=>{this.disabled||this.readonly||(this.inputValue=t.target.value,this.isPopoverOpen||this.popoverElement.present(),this.focusIndex=-1,this.updateFocus(),g(t),this.balInput.emit(this.inputValue))},this.handleOptionMouseEnter=t=>{this.focusIndex=t},this.hasFocus=!1,this.inputValue="",this.focusIndex=-1,this.isPopoverOpen=!1,this.options=new Map,this.labelToScrollTo="",this.labelToSelectTo="",this.name=this.inputId,this.invalid=!1,this.filter="includes",this.balTabindex=0,this.multiple=!1,this.maxLength=void 0,this.noDataLabel=void 0,this.noBorder=!1,this.autocomplete="off",this.hasMovement=!1,this.typeahead=!1,this.selectionOptional=!1,this.disabled=!1,this.readonly=!1,this.required=!1,this.inverted=!1,this.placeholder=void 0,this.scrollable=250,this.loading=!1,this.remote=!1,this.value=[],this.rawValue=[]}createLogger(t){this.log=t}valueWatcher(){this.syncRawValue(!1)}updateRawValue(t,i=!0){b(t,this.rawValue||[])||(this.rawValue=[...t],this.syncNativeInput(),this.didInit&&!0===i&&(this.multiple?l(this.rawValue)?this.emitChangeEvent([]):this.emitChangeEvent([...this.rawValue]):l(this.rawValue)||0===v(this.rawValue)?this.emitChangeEvent(void 0):this.emitChangeEvent(this.rawValue[0])))}emitChangeEvent(t){this.balChange.emit(t)}connectedCallback(){const t=r((()=>this.updateOptions()),0);this.initialValue=this.value,t(),this.mutationO=(i=>{if("undefined"==typeof MutationObserver)return;const s=new MutationObserver((i=>{(i=i.filter((t=>t.target.nodeName==="bal-select-option".toUpperCase()||t.target.nodeName==="bal-select".toUpperCase()))).length>0&&t()}));return s.observe(i,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),s})(this.el)}componentWillLoad(){if(this.waitForOptionsAndThenUpdateRawValues(),!l(this.rawValue)&&this.options.size>0&&1===v(this.rawValue)){const t=this.options.get(this.rawValue[0]);l(t)||(this.inputValue=t.label)}}componentDidLoad(){this.syncRawValue(!1),this.multiple||(this.inputElement.value=this.inputValue),this.didInit=!0}disconnectedCallback(){this.mutationO&&(this.mutationO.disconnect(),this.mutationO=void 0)}listenOnClick(t){this.disabled&&t.target&&t.target===this.el&&g(t)}resetHandler(t){const i=t.target;(null==i?void 0:i.contains(this.el))&&(this.resetHandlerTimer&&clearTimeout(this.resetHandlerTimer),this.resetHandlerTimer=setTimeout((()=>{this.value=this.initialValue,this.syncRawValue(!1),this.syncNativeInput(),this.nativeSelectEl&&Array.from(this.nativeSelectEl.options).forEach((t=>t.selected=!0))}),0))}async handleKeyDown(t){if(this.isPopoverOpen){if((d(t)||p(t))&&(g(t),this.navigateWithArrowKey(t),this.updateFocus()),u(t)&&(g(t),this.selectedFocusedOption()),m(t)&&this.cancel(),_(t)&&this.typeahead&&this.multiple&&""===this.inputElement.value&&v(this.rawValue)>0){const t=y(this.rawValue);this.removeValue(t[v(this.rawValue)-1])}this.typeahead||1!==t.key.length||this.focusOptionByLabel(t.key),c(t)&&!this.typeahead&&g(t)}else this.hasFocus&&((d(t)||p(t))&&(g(t),await this.open()),this.typeahead||1!==t.key.length||this.selectOptionByLabel(t.key))}async setFocus(){clearTimeout(this.setFocusTimer),this.setFocusTimer=setTimeout((()=>{this.inputElement&&!this.disabled&&this.inputElement.focus()}))}async getValue(){return this.rawValue}async clear(){this.focusIndex=-1,this.inputElement&&(this.updateInputValue(""),this.updateRawValue([],!0),this.value=this.multiple?[]:"")}async open(){this.disabled||this.readonly||l(this.popoverElement)||await this.popoverElement.present()}async close(){this.disabled||this.readonly||l(this.popoverElement)||this.blurSelect()}async cancel(){this.labelToScrollTo="",this.close(),this.scrollTo(0),this.balCancel.emit()}async select(t){const i=this.options.get(t);l(i)||this.optionSelected(i)}async waitForOptionsAndThenUpdateRawValues(){clearTimeout(this.waitForOptionsAndThenUpdateRawValuesTimer),await a(this.el),this.options.size>0?this.remote||this.syncRawValue(!1):this.waitForOptionsAndThenUpdateRawValuesTimer=setTimeout((()=>this.waitForOptionsAndThenUpdateRawValues()),10)}async updateOptions(){const t=this.getChildOpts(),i=new Map;for(let s=0;s<t.length;s++){const e=t[s];i.set(e.value,{value:e.value,label:e.label,disabled:e.disabled,id:e.for,textContent:e.textContent,innerHTML:e.innerHTML})}if(!this.selectionOptional&&Array.isArray(this.rawValue))for(let t=0;t<this.rawValue.length;t++){const s=this.rawValue[t];if(!i.has(s)){const t=f(this.rawValue,s);this.updateRawValue(t,!1)}}this.options=new Map(i),this.typeahead||await this.syncNativeInput(),this.didInit&&!this.remote&&this.validateAfterBlur()}get optionArray(){const t=Array.from(this.options,(([t,i])=>i));return!this.typeahead||this.remote?t:t.filter((t=>"includes"===this.filter?x(t.textContent,this.inputValue):w(t.textContent,this.inputValue)))}hasOptions(){return this.optionArray.length>0}get inputPlaceholder(){return this.multiple?v(this.rawValue)<1?this.placeholder:void 0:!l(this.rawValue)&&v(this.rawValue)>0?void 0:this.placeholder}getChildOpts(){return Array.from(this.el.querySelectorAll("bal-select-option"))}getPopoverContent(){return this.popoverElement.querySelector(".bal-popover__content__inner")}updateFocus(){this.focusIndex<-1&&(this.focusIndex=-1);const t=this.optionArray;if(t.length>0){t.length<=this.focusIndex&&(this.focusIndex=t.length-1);const i=t[this.focusIndex];if(i&&i.id){const t=this.el.querySelector(`button#${i.id}`);t&&(clearTimeout(this.updateFocusTimer),this.updateFocusTimer=setTimeout((()=>{this.scrollToFocusedOption(t)}),0))}}else this.focusIndex=-1}scrollToFocusedOption(t){if(t&&this.popoverElement){const i=this.getPopoverContent();if(i){const s=t.offsetTop;s<i.scrollTop&&(i.scrollTop=s),t.offsetTop+t.clientHeight>i.scrollTop+i.clientHeight&&(i.scrollTop=i.scrollTop+t.clientHeight)}}}scrollTo(t){const i=this.getPopoverContent();i&&(i.scrollTop=t)}selectedFocusedOption(){const t=this.optionArray;if(t.length>this.focusIndex){const i=t[this.focusIndex];i&&this.optionSelected(i)}}navigateWithArrowKey(t){d(t)?this.focusIndex=this.focusIndex+1:p(t)&&(this.focusIndex=this.focusIndex-1)}focusOptionByLabel(t){this.labelToScrollTo=this.labelToScrollTo+t,clearTimeout(this.clearScrollToValue),this.clearScrollToValue=setTimeout((()=>{this.scrollToLabel(this.labelToScrollTo)}),600)}selectOptionByLabel(t){this.labelToSelectTo=this.labelToSelectTo+t,clearTimeout(this.clearSelectValue),this.clearSelectValue=setTimeout((()=>{this.selectLabel(this.labelToSelectTo),this.labelToSelectTo=""}),600)}async selectLabel(t){if(" "!==t){const i=this.optionArray.find((i=>w(i.label||"",t)));if(!l(i)&&i.id){const t=this.el.querySelector(`button#${i.id}`);if(!l(t)){const t=this.optionArray.indexOf(i);this.focusIndex=t,this.select(i.value)}}this.labelToScrollTo=""}}async scrollToLabel(t){if(" "!==t){const i=this.optionArray.find((i=>w(i.label||"",t)));if(!l(i)&&i.id){const t=this.el.querySelector(`button#${i.id}`);if(!l(t)){const s=this.optionArray.indexOf(i);this.focusIndex=s,this.scrollTo(t.offsetTop)}}this.labelToScrollTo=""}}syncRawValue(t=!0){let i=[];l(this.value)||""===this.value||(i=A(this.value)?[...this.value.filter((t=>!l(t)))]:this.value.split("").includes(",")?[...this.value.split(",").filter((t=>t)).map((t=>t.trim()))]:[this.value]),this.updateRawValue(i,t)}blurSelect(){this.popoverElement.dismiss()}optionSelected(t){const i=y(this.rawValue).some((i=>i===t.value));this.updateValue(t.value,!i),this.multiple?this.typeahead&&this.setFocus():this.blurSelect()}updateValue(t,i=!0){this.multiple?this.updateRawValue(i?k(this.rawValue,t,this.multiple):f(this.rawValue,t),!0):(this.updateRawValue(k(this.rawValue,t,this.multiple),!0),this.rawValue&&this.rawValue.length>0&&this.updateInputValue(j(this.options,this.rawValue[0])))}validateAfterBlur(t=!1){let i=this.rawValue;if(this.didInit&&!this.multiple){if(this.typeahead&&(this.selectionOptional||this.remote)){const t=O(this.options,this.inputElement.value);i=t?[t.value]:[this.inputElement.value]}else i=C(this.rawValue,this.options,this.inputElement.value);this.updateRawValue(i,t)}}syncNativeInput(){if(!this.multiple&&v(this.rawValue)>0){const t=y(this.rawValue);let i=j(this.options,t[0]);return!this.multiple&&this.typeahead&&this.selectionOptional&&""===i&&(i=t.join(", ")),this.updateInputValue(i)}return Promise.resolve()}updateInputValue(t){return new Promise((i=>{this.updateInputValueTimer&&clearTimeout(this.updateInputValueTimer),this.updateInputValueTimer=setTimeout((()=>{l(this.inputElement)||(this.inputElement.value=t,this.inputValue=t,i())}),0)}))}isChipClicked(t){let i=!1;if(this.multiple){const s=this.selectionEl.querySelectorAll("bal-tag"),e=t.target;s.forEach((t=>{const s=h(t,e)||t===e;s&&(i=s)}))}return i}render(){var t;const i=this.inputId+"-lbl",o=n(this.el);o&&(o.id=i,o.htmlFor=this.inputId);const l=t=>s("bal-tag",{size:"",closable:!this.disabled,disabled:this.disabled,invalid:this.invalid,tabindex:-1,onBalCloseClick:()=>this.removeValue(t.value)},j(this.options,t.value)||t.value),a=y(this.rawValue),h=L.block("select"),r=h.element("native"),c=h.element("control"),b=c.element("icon"),d=c.element("selections"),p=c.element("input"),u=h.element("popover"),m=u.element("empty"),_=h.element("option"),f=_.element("content"),v=f.element("checkbox"),x=f.element("label");return s(e,{role:"listbox",onClick:this.handleClick,"aria-disabled":this.disabled?"true":null,"data-value":null===(t=this.rawValue)||void 0===t?void 0:t.map((t=>j(this.options,t))).join(","),class:Object.assign(Object.assign(Object.assign({},h.class()),h.modifier("disabled").class(this.disabled||this.readonly)),h.modifier("inverted").class(this.inverted))},s("select",{class:Object.assign({},r.class()),name:this.name,multiple:this.multiple,required:this.required,tabindex:-1,ref:t=>this.nativeSelectEl=t},a.map((t=>s("option",{value:t,selected:!0},t)))),s("bal-popover",{onBalChange:this.handlePopoverChange,ref:t=>this.popoverElement=t},s("div",{"bal-popover-trigger":!0,class:Object.assign(Object.assign(Object.assign(Object.assign({},c.class()),c.modifier("invalid").class(this.invalid)),c.modifier("disabled").class(this.disabled||this.readonly)),c.modifier("focused").class(this.isPopoverOpen))},s("div",{class:Object.assign(Object.assign({},d.class()),d.modifier("clickable").class(!this.isPopoverOpen&&!this.disabled&&!this.readonly)),onClick:this.handleInputClick,ref:t=>this.selectionEl=t},a.filter((()=>this.multiple)).map((t=>s(l,{value:t}))),s("input",{type:"text",class:Object.assign(Object.assign({},p.class()),{input:!0,"is-inverted":this.inverted,"is-danger":this.invalid,"is-disabled":this.disabled||this.readonly,"is-clickable":!this.isPopoverOpen&&!this.disabled&&!this.readonly,"data-test-select-input":!0}),autocomplete:this.autocomplete,placeholder:this.inputPlaceholder,readonly:!this.typeahead||this.disabled||this.readonly,contentEditable:this.typeahead,disabled:this.disabled,maxLength:this.maxLength,tabindex:this.balTabindex,onInput:this.handleInput,onClick:this.handleInputClick,onChange:this.handleInputChange,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onKeyPress:this.handleKeyPress,ref:t=>this.inputElement=t})),s("bal-icon",{class:Object.assign(Object.assign(Object.assign({},b.class()),b.modifier("loading").class(this.loading)),b.modifier("clickable").class(!this.disabled&&!this.readonly)),name:"caret-down",color:this.disabled||this.readonly?"grey-light":this.invalid?"danger":"primary",turn:this.isPopoverOpen,onClick:this.handleInputClick})),s("bal-popover-content",{class:Object.assign({},u.class()),scrollable:this.scrollable,spaceless:!0,expanded:!0},this.optionArray.map(((t,i)=>s("button",{type:"button",role:"option",id:t.id,"data-value":t.value,"data-label":t.label,class:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},_.class()),_.modifier("selected").class(a.includes(t.value)&&!(this.typeahead&&!this.multiple))),_.modifier("focused").class(this.focusIndex===i)),_.modifier("checkbox").class(this.multiple)),_.modifier("disabled").class(!0===t.disabled)),disabled:t.disabled,tabIndex:-1,onMouseEnter:()=>this.handleOptionMouseEnter(i),onClick:()=>this.optionSelected(t)},s("div",{class:Object.assign({},f.class())},s("span",{class:Object.assign({},v.class()),style:{display:this.multiple?"flex":"none"}},s("bal-checkbox",{checked:a.includes(t.value),tabindex:-1,hidden:!0,flat:!0,onBalChange:g})),s("span",{class:Object.assign({},x.class()),innerHTML:t.innerHTML}))))),s("div",{class:Object.assign(Object.assign({},m.class()),m.modifier("hidden").class(void 0===this.noDataLabel||this.hasOptions()||!this.typeahead||this.selectionOptional))},this.noDataLabel))))}get el(){return o(this)}static get watchers(){return{value:["valueWatcher"]}}};!function(t,i,s,e){var o,l=arguments.length,a=l<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,s,e);else for(var h=t.length-1;h>=0;h--)(o=t[h])&&(a=(l<3?o(a):l>3?o(i,s,a):o(i,s))||a);l>3&&a&&Object.defineProperty(i,s,a)}([z("bal-select")],B.prototype,"createLogger",null);let R=0;B.style={css:"bal-select-option{display:none !important}.bal-select{display:block;position:relative;width:100%;-ms-flex:1;flex:1;font-family:var(--bal-font-family-text)}.bal-select__popover{border:.125rem solid var(--bal-color-grey-2)}.bal-select__popover__empty{padding:.5rem 1rem;font-family:var(--bal-font-family-text);color:var(--bal-color-primary)}.bal-select__popover__empty--hidden{display:none}.bal-select__native{position:absolute;left:0;top:0;margin:0;padding:0;opacity:0;outline:0;border:none;width:1px;height:1px}.bal-select__control{display:-ms-flexbox;display:flex;border-width:.125rem;border-style:solid;border-color:var(--bal-color-border-grey);border-radius:var(--bal-radius-normal);background:var(--bal-color-primary-inverted);font-size:var(--bal-weight-regular);font-family:var(--bal-font-family-text);color:var(--bal-color-primary);outline:none;-webkit-box-shadow:none;box-shadow:none;padding-right:1rem;min-height:3rem}.bal-select__control--focused{border-color:var(--bal-color-primary)}.bal-select__control:not(.bal-select__control--disabled):not(.bal-select__control--invalid):hover{border-color:var(--bal-color-border-grey);background-color:var(--bal-color-grey-1)}.bal-select__control:not(.bal-select__control--disabled):not(.bal-select__control--invalid):hover .bal-select__control__input{background-color:var(--bal-color-grey-1)}.bal-select__control:focus-within{border-color:var(--bal-color-primary) !important}.bal-select__control--invalid:not(.bal-select__control--disabled){border-color:var(--bal-color-border-danger) !important;background:var(--bal-color-danger-1) !important}.bal-select__control--disabled{background-color:var(--bal-color-grey-2) !important;border-color:var(--bal-color-border-grey-dark) !important}.bal-select__control--disabled,.bal-select__control--disabled input{cursor:default !important;-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important;user-select:none !important;pointer-events:none !important;color:var(--bal-color-text-grey)}.bal-select__control__icon{min-height:100% !important;max-height:100% !important}.bal-select__control__icon--loading{display:none}.bal-select__control__icon--clickable{cursor:pointer}.bal-select__control__selections{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;-ms-flex:1 1;flex:1 1;-ms-flex-wrap:wrap;flex-wrap:wrap;line-height:1.125rem;max-width:100%;min-width:0;gap:0;padding-left:.375rem}.bal-select__control__selections .bal-tag{margin-left:.25rem;margin-top:.375rem;margin-bottom:.375rem}.bal-select__control__selections .bal-tag+.input{padding-left:.625rem}.bal-select__control__input{border:none !important;outline:none !important;outline-width:0 !important;height:2.75rem !important;-webkit-box-shadow:none !important;box-shadow:none !important;background:transparent;-ms-flex:1;flex:1;min-height:2.75rem !important;padding-left:.25rem !important;padding-right:.625rem !important;text-overflow:ellipsis}.bal-select__control__input:-moz-read-only{-moz-user-select:none !important;user-select:none !important;-webkit-tap-highlight-color:rgba(0,0,0,0)}.bal-select__control__input:read-only{-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important;user-select:none !important;-webkit-tap-highlight-color:rgba(0,0,0,0)}.bal-select__control__input:read-only::-moz-selection{background:transparent}.bal-select__control__input:-moz-read-only::selection{background:transparent}.bal-select__control__input:read-only::selection{background:transparent}.bal-select__control__input:-moz-read-only::-moz-selection{background:transparent}.bal-select__control__input:read-only::-moz-selection{background:transparent}.bal-select__option{visibility:visible;font-family:var(--bal-font-family-text);background:transparent;border:none;cursor:pointer;outline:none;min-height:3rem;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;padding:0;margin:0;border-top:.125rem solid var(--bal-color-grey-2);text-align:inherit;white-space:nowrap;width:100%}.bal-select__option:first-child{border-top:none}.bal-select__option::-moz-focus-inner{border:none}.bal-select__option--selected{background:var(--bal-color-primary-1)}.bal-select__option--selected .bal-select__option__content__label{font-weight:var(--bal-weight-bold)}.bal-select__option--focused{background:var(--bal-color-grey-2)}.bal-select__option:hover{background:var(--bal-color-grey-2)}.bal-select__option__content{display:-ms-flexbox;display:flex;-ms-flex:1;flex:1;-ms-flex-align:center;align-items:center;min-height:3rem;padding:.75rem 1rem;gap:.75rem}.bal-select__option__content__checkbox{margin:0;padding:0}.bal-select__option__content__label{margin:0;padding:0;font-family:var(--bal-font-family-text);font-weight:var(--bal-weight-regular);color:var(--bal-color-primary);line-height:1.125rem;word-break:break-word;white-space:normal;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}"};const M=class{constructor(i){t(this,i),this.label=void 0,this.disabled=!1,this.value=void 0,this.for="bal-selopt-"+F++}createLogger(t){this.log=t}render(){return s(e,{style:{display:"none"}},s("slot",null))}};!function(t,i,s,e){var o,l=arguments.length,a=l<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,s,e);else for(var h=t.length-1;h>=0;h--)(o=t[h])&&(a=(l<3?o(a):l>3?o(i,s,a):o(i,s))||a);l>3&&a&&Object.defineProperty(i,s,a)}([z("bal-select-option")],M.prototype,"createLogger",null);let F=0;export{B as bal_select,M as bal_select_option}